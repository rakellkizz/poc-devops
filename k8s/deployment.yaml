# ==========================================================
# Deployment â€” POC DevOps / SRE
# ----------------------------------------------------------
# ResponsÃ¡vel por:
# - Criar e manter os Pods
# - Garantir alta disponibilidade
# - Gerenciar atualizaÃ§Ãµes
# ==========================================================

apiVersion: apps/v1
kind: Deployment

metadata:
  name: poc-devops-deployment
  labels:
    app: poc-devops

spec:
  # Quantidade de rÃ©plicas (pods)
  replicas: 2

  # Como o Kubernetes identifica quais pods pertencem a esse deployment
  selector:
    matchLabels:
      app: poc-devops

  # Template do Pod (modelo)
  template:
    metadata:
      labels:
        app: poc-devops

    spec:
      containers:
        - name: poc-devops-container

          # Imagem criada no Docker
          image: poc-devops:latest

          # Porta interna do container
          ports:
            - containerPort: 8000

          # VariÃ¡veis de ambiente
          env:
            - name: ENV
              value: "kubernetes"

          # Prova de mentalidade SRE ðŸ‘‡
          # Liveness Probe â†’ reinicia se travar
          livenessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 10
            periodSeconds: 10

          # Readiness Probe â†’ sÃ³ recebe trÃ¡fego se estiver pronto
          readinessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 5
            periodSeconds: 5
