# ==========================================================
# Deployment ‚Äî POC DevOps / SRE
# ----------------------------------------------------------
# Respons√°vel por:
# - Criar e manter os Pods
# - Garantir alta disponibilidade
# - Gerenciar atualiza√ß√µes
# ==========================================================

apiVersion: apps/v1
kind: Deployment

metadata:
  name: poc-devops-deployment
  labels:
    app: poc-devops

spec:
  # Quantidade de r√©plicas (pods)
  replicas: 2

  # Como o Kubernetes identifica quais pods pertencem a esse deployment
  selector:
    matchLabels:
      app: poc-devops

  # Template do Pod (modelo)
  template:
    metadata:
      labels:
        app: poc-devops

    spec:
      containers:
        - name: poc-devops-container

          # Imagem criada no Docker
          image: poc-devops:latest

          # Pol√≠tica de pull da imagem
          imagePullPolicy: IfNotPresent

          # Porta interna do container
          ports:
            - containerPort: 8000

          # Vari√°veis de ambiente
          env:
            - name: ENV
              value: "kubernetes"

          # Prova de mentalidade SRE üëá
          # Liveness Probe ‚Üí reinicia se travar
          livenessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 10
            periodSeconds: 10

          # Readiness Probe ‚Üí s√≥ recebe tr√°fego se estiver pronto
          readinessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 5
            periodSeconds: 5
